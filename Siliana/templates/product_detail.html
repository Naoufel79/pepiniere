{% extends 'store_base.html' %}
{% load static %}

{% block title %}{{ produit.nom }} - مزرعة نوادر التين{% endblock %}

{% block content %}
<section class="section">
  <a class="btn btn-ghost" href="{% url 'products_catalog' %}">← الرجوع للمنتجات</a>

  <div class="checkout-grid" style="margin-top:14px">
    <div class="panel">
      <div style="display:grid;gap:14px">
        <div class="card" style="overflow:hidden">
          <div class="product-media" style="aspect-ratio: 16/10">
            {% if produit.image %}
              <img data-skeleton src="{{ produit.image.url }}" alt="{{ produit.nom|escape }}" loading="eager" decoding="async" />
            {% else %}
              <div style="height:100%;display:flex;align-items:center;justify-content:center;color:rgba(229,231,235,.55);">لا توجد صورة</div>
            {% endif %}
          </div>
        </div>

        <div>
          <h1 class="section-title" style="margin-bottom:8px">{{ produit.nom }}</h1>
          <p class="section-subtitle" style="margin-bottom:12px">{% if produit.description %}{{ produit.description }}{% else %}وصف غير متوفر.{% endif %}</p>

          <div class="panel" style="background:rgba(255,255,255,.03)">
            <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
              <div>
                <div style="color:var(--muted);font-weight:800">السعر</div>
                <div style="font-size:28px;font-weight:950">{{ produit.prix_vente }} د.ت</div>
              </div>
              <div>
                {% if produit.quantite > 0 %}
                  <div class="status ok">متوفر ({{ produit.quantite }})</div>
                {% else %}
                  <div class="status no">غير متوفر</div>
                {% endif %}
              </div>
            </div>

            <div class="card-actions" style="margin-top:14px">
              <button
                class="btn btn-primary"
                type="button"
                {% if produit.quantite <= 0 %}disabled{% endif %}
                onclick="window.storeAddToCart({ id: '{{ produit.id }}', name: '{{ produit.nom|escapejs }}', price: '{{ produit.prix_vente }}', imageUrl: '{% if produit.image %}{{ produit.image.url }}{% endif %}' })"
              >
                أضف للسلة
              </button>
              <a class="btn btn-ghost" href="{% url 'cart' %}">عرض السلة</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <aside class="checkout-aside">
      <div class="panel">
        <div class="panel-title">إتمام الطلب</div>
        <div style="color:var(--muted);line-height:1.7">
          بعد إضافة المنتجات إلى السلة، انتقل لإتمام الطلب وتأكيد الهاتف.
        </div>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn btn-primary" href="{% url 'public_order' %}">إتمام الطلب</a>
          <a class="btn btn-ghost" href="{% url 'products_catalog' %}">متابعة التسوق</a>
        </div>
      </div>
    </aside>
  </div>
</section>

{% if similar_products %}
<section class="section">
  <h2 class="section-title">منتجات مشابهة</h2>
  <div class="grid products-grid">
    {% for p in similar_products %}
      <article class="card product-card">
        <a href="{% url 'product_detail' p.id %}" style="color:inherit;text-decoration:none;">
          <div class="product-media">
            {% if p.image %}
              <img data-skeleton src="{{ p.image.url }}" alt="{{ p.nom|escape }}" loading="lazy" decoding="async" />
            {% else %}
              <div style="height:100%;display:flex;align-items:center;justify-content:center;color:rgba(229,231,235,.55);">لا توجد صورة</div>
            {% endif %}
          </div>
        </a>
        <div class="card-body">
          <h3 class="product-title">{{ p.nom }}</h3>
          <div class="product-meta">
            <div class="price">{{ p.prix_vente }} د.ت</div>
            {% if p.quantite > 0 %}<div class="status ok">متوفر</div>{% else %}<div class="status no">غير متوفر</div>{% endif %}
          </div>
          <div class="card-actions">
            <a class="btn btn-ghost" href="{% url 'product_detail' p.id %}">التفاصيل</a>
            <button class="btn btn-primary" type="button" {% if p.quantite <= 0 %}disabled{% endif %}
              onclick="window.storeAddToCart({ id: '{{ p.id }}', name: '{{ p.nom|escapejs }}', price: '{{ p.prix_vente }}', imageUrl: '{% if p.image %}{{ p.image.url }}{% endif %}' })">
              أضف للسلة
            </button>
          </div>
        </div>
      </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% endblock %}
